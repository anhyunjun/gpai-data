<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATHKONG ë§ˆì¼€íŒ… ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .metric-card {
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        }
        .gradient-purple {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-green {
            background: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);
        }
        .performance-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Phase 6 Strategy Banner -->
    <div class="gradient-purple text-white py-16 px-6 text-center mb-8">
        <h1 class="text-4xl font-bold mb-4">ë‹¤ìŒ ë‹¨ê³„: AI ì „ëµ íšŒì˜</h1>
        <p class="text-xl mb-6">Claude & Gemini 2.5 Proì™€ í•¨ê»˜ ë‹¤ìŒ ì£¼ ì•¡ì…˜ í”Œëœì„ ìˆ˜ë¦½í•˜ì„¸ìš”</p>
        <button class="bg-white text-purple-700 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
            Phase 6 ì „ëµ íšŒì˜ ì‹œì‘ â†’
        </button>
    </div>

    <!-- Data Upload Section -->
    <div class="gradient-green text-white py-12 px-6 text-center mb-8">
        <h2 class="text-2xl font-bold mb-4">ìƒˆë¡œìš´ ë°ì´í„° ë¶„ì„í•˜ê¸°</h2>
        <p class="text-lg mb-6">CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ë§ˆì¼€íŒ… ì„±ê³¼ë¥¼ ë¶„ì„í•˜ì„¸ìš”</p>
        <label for="file-upload" class="cursor-pointer inline-flex items-center px-6 py-3 bg-white text-green-700 font-medium rounded-lg hover:bg-gray-100 transition-colors">
            <i data-lucide="cloud-upload" class="w-5 h-5 mr-2"></i>
            ë°ì´í„° ì—…ë¡œë“œ
        </label>
        <input id="file-upload" type="file" accept=".csv,.xlsx,.xls" class="hidden" onchange="handleFileUpload(event)">
    </div>

    <div class="container mx-auto px-6">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">MATHKONG ë§ˆì¼€íŒ… ëŒ€ì‹œë³´ë“œ</h1>
            <div class="flex items-center gap-4 mt-2 text-sm text-gray-600">
                <span>ë¶„ì„ ê¸°ê°„: <span id="date-range">-</span></span>
                <span>ì´ ìº í˜ì¸: <span id="campaign-count">0ê°œ</span></span>
                <span>í”Œë«í¼: <span id="platform">-</span></span>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="flex gap-3 mb-6">
            <button id="clear-btn" onclick="clearData()" class="hidden inline-flex items-center px-4 py-2 bg-red-50 text-red-700 font-medium rounded-lg hover:bg-red-100 transition-colors">
                <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                ë°ì´í„° ì‚­ì œ
            </button>
            <button onclick="exportReport()" class="hidden inline-flex items-center px-4 py-2 bg-blue-50 text-blue-700 font-medium rounded-lg hover:bg-blue-100 transition-colors" id="export-btn">
                <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ
            </button>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="bg-white rounded-xl shadow-sm border border-gray-200 p-16 text-center">
            <i data-lucide="bar-chart-2" class="w-16 h-16 mx-auto text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p class="text-gray-600">ìƒë‹¨ì˜ ë°ì´í„° ì—…ë¡œë“œ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</p>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboard" class="hidden space-y-8">
            <!-- Key Metrics -->
            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
                <div class="metric-card bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">ì´ íˆ¬ìì•¡</span>
                        <div class="p-2 bg-blue-100 rounded-lg">
                            <i data-lucide="wallet" class="w-4 h-4 text-blue-700"></i>
                        </div>
                    </div>
                    <div class="text-2xl font-bold text-gray-900" id="total-spend">â‚©0</div>
                    <p class="text-xs text-gray-500 mt-1" id="spend-date">-</p>
                </div>

                <div class="metric-card bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">ì´ ê°€ì…ììˆ˜</span>
                        <div class="p-2 bg-green-100 rounded-lg">
                            <i data-lucide="users" class="w-4 h-4 text-green-700"></i>
                        </div>
                    </div>
                    <div class="text-2xl font-bold text-gray-900" id="total-conversions">0ëª…</div>
                    <p class="text-xs mt-1">
                        ëª©í‘œ ëŒ€ë¹„ <span class="text-green-600 font-semibold" id="conversion-rate">+0%</span>
                    </p>
                </div>

                <div class="metric-card bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">í‰ê·  CPA</span>
                        <div class="p-2 bg-purple-100 rounded-lg">
                            <i data-lucide="trending-down" class="w-4 h-4 text-purple-700"></i>
                        </div>
                    </div>
                    <div class="text-2xl font-bold text-gray-900" id="avg-cpa">â‚©0</div>
                    <p class="text-xs mt-1">
                        ì—…ê³„ í‰ê·  ëŒ€ë¹„ <span class="text-purple-600 font-semibold" id="cpa-comparison">-0%</span>
                    </p>
                </div>

                <div class="metric-card bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">í‰ê·  CVR</span>
                        <div class="p-2 bg-orange-100 rounded-lg">
                            <i data-lucide="target" class="w-4 h-4 text-orange-700"></i>
                        </div>
                    </div>
                    <div class="text-2xl font-bold text-gray-900" id="avg-cvr">0%</div>
                    <p class="text-xs mt-1">
                        ì—…ê³„ í‰ê·  ëŒ€ë¹„ <span class="text-orange-600 font-semibold" id="cvr-comparison">+0%</span>
                    </p>
                </div>
            </div>

            <!-- AI Recommendations -->
            <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸš€ ì¦‰ì‹œ ì‹¤í–‰ ê¶Œì¥ì‚¬í•­</h3>
                <div id="recommendations" class="grid gap-4 md:grid-cols-3">
                    <!-- Recommendations will be inserted here -->
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">íƒ€ê²Ÿë³„ CPA ì„±ê³¼</h3>
                    <div style="position: relative; height: 300px;">
                        <canvas id="cpa-chart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">íƒ€ê²Ÿë³„ ì „í™˜ ë¹„ì¤‘</h3>
                    <div style="position: relative; height: 300px;">
                        <canvas id="pie-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Campaign Performance Table -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                <div class="p-6 border-b border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900">ìº í˜ì¸ë³„ ìƒì„¸ ì„±ê³¼</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-100">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìˆœìœ„</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">íƒ€ê²Ÿ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ì§€ì¶œ(ì›)</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ê°€ì…ì</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">CPA(ì›)</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">CVR(%)</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody id="campaign-table-body" class="bg-white divide-y divide-gray-100">
                            <!-- Table rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let adData = [];
        let charts = {};

        // Initialize Lucide icons
        lucide.createIcons();

        // Load data from localStorage on page load
        window.onload = function() {
            const savedData = localStorage.getItem('adData');
            if (savedData) {
                adData = JSON.parse(savedData);
                if (adData.length > 0) {
                    showDashboard();
                }
            }
        };

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let jsonData;
                    
                    if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
                        // CSV íŒŒì¼ ì²˜ë¦¬
                        const csvText = e.target.result;
                        const lines = csvText.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim().replace(/["\uFEFF]/g, ''));
                        
                        jsonData = [];
                        for (let i = 1; i < lines.length; i++) {
                            if (lines[i].trim() === '') continue;
                            
                            const values = [];
                            let current = '';
                            let inQuotes = false;
                            
                            for (let char of lines[i]) {
                                if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    values.push(current.trim());
                                    current = '';
                                } else {
                                    current += char;
                                }
                            }
                            values.push(current.trim());
                            
                            const row = {};
                            headers.forEach((header, index) => {
                                row[header] = values[index] || '';
                            });
                            jsonData.push(row);
                        }
                    } else {
                        // Excel íŒŒì¼ ì²˜ë¦¬
                        const data = e.target.result;
                        const workbook = XLSX.read(data, { type: 'binary' });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        jsonData = XLSX.utils.sheet_to_json(worksheet);
                    }
                    
                    // Process and validate data - Meta Ads í˜•ì‹ ì§€ì›
                    adData = jsonData.map((row, index) => {
                        // Meta Ads í˜•ì‹ ì²´í¬
                        if ('ë…¸ì¶œ' in row && 'í´ë¦­(ì „ì²´)' in row) {
                            const impressions = Number(String(row['ë…¸ì¶œ']).replace(/,/g, '')) || 0;
                            const clicks = Number(String(row['í´ë¦­(ì „ì²´)']).replace(/,/g, '')) || 0;
                            const spend = Number(String(row['ì§€ì¶œ ê¸ˆì•¡ (USD)']).replace(/,/g, '')) || 0;
                            const conversions = 0; // Meta Adsì—ì„œëŠ” ê²°ê³¼ê°€ ì „í™˜ì´ ì•„ë‹ ìˆ˜ ìˆìŒ
                            
                            // ê´‘ê³  ì„¸íŠ¸ ì´ë¦„ì—ì„œ íƒ€ê²Ÿ ì¶”ì¶œ
                            const adSetName = row['ê´‘ê³  ì„¸íŠ¸ ì´ë¦„'] || '';
                            let target = 'ê¸°íƒ€';
                            if (adSetName.includes('ì¸ë„')) target = 'ì¹¸ì•„ì¹´ë°ë¯¸';
                            else if (adSetName.includes('GPA')) target = 'GPA';
                            else if (adSetName.includes('IB')) target = 'IB';
                            else if (adSetName.includes('ACT')) target = 'ACT';
                            else if (adSetName.includes('AP')) target = 'AP';
                            else if (adSetName.includes('SAT')) target = 'SAT';
                            else if (adSetName.includes('ì¿ ëª¬')) target = 'ì¿ ëª¬';
                            
                            return {
                                date: row['ë³´ê³  ì‹œì‘'] || new Date().toISOString().split('T')[0],
                                campaign: row['ìº í˜ì¸ ì´ë¦„'] || 'Unknown',
                                target: target,
                                adName: row['ê´‘ê³  ì´ë¦„'] || 'Unknown',
                                impressions: impressions,
                                clicks: clicks,
                                conversions: conversions,
                                spend: Math.round(spend * 1350), // USD to KRW ë³€í™˜
                                revenue: Math.round(conversions * 50000), // ê°€ì •: ì „í™˜ë‹¹ 5ë§Œì›
                                ctr: impressions > 0 ? (clicks / impressions * 100).toFixed(2) : 0,
                                cvr: clicks > 0 ? (conversions / clicks * 100).toFixed(2) : 0,
                                cpa: conversions > 0 ? Math.round((spend * 1350) / conversions) : 0,
                                roi: spend > 0 ? (((conversions * 50000) - (spend * 1350)) / (spend * 1350) * 100).toFixed(1) : 0
                            };
                        } else {
                            // ê¸°ì¡´ í˜•ì‹
                            const impressions = Number(row.impressions) || 0;
                            const clicks = Number(row.clicks) || 0;
                            const conversions = Number(row.conversions) || 0;
                            const spend = Number(row.spend) || 0;
                            const revenue = Number(row.revenue) || 0;
                            
                            return {
                                date: row.date || new Date().toISOString().split('T')[0],
                                campaign: row.campaign || 'Unknown',
                                target: row.target || 'Unknown',
                                impressions: impressions,
                                clicks: clicks,
                                conversions: conversions,
                                spend: spend,
                                revenue: revenue,
                                ctr: impressions > 0 ? (clicks / impressions * 100).toFixed(2) : 0,
                                cvr: clicks > 0 ? (conversions / clicks * 100).toFixed(2) : 0,
                                cpa: conversions > 0 ? Math.round(spend / conversions) : 0,
                                roi: spend > 0 ? ((revenue - spend) / spend * 100).toFixed(1) : 0
                            };
                        }
                    });
                    
                    // Save to localStorage
                    localStorage.setItem('adData', JSON.stringify(adData));
                    
                    // Show dashboard
                    showDashboard();
                    
                } catch (error) {
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            
            if (file.type === 'text/csv') {
                reader.readAsText(file);
            } else {
                reader.readAsBinaryString(file);
            }
        }

        function clearData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                adData = [];
                localStorage.removeItem('adData');
                document.getElementById('empty-state').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('clear-btn').classList.add('hidden');
                document.getElementById('export-btn').classList.add('hidden');
            }
        }

        function showDashboard() {
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('clear-btn').classList.remove('hidden');
            document.getElementById('export-btn').classList.remove('hidden');
            
            updateMetrics();
            updateCharts();
            updateTable();
            generateRecommendations();
            
            // Re-initialize Lucide icons for new elements
            lucide.createIcons();
        }

        function updateMetrics() {
            const totalSpend = adData.reduce((sum, item) => sum + item.spend, 0);
            const totalConversions = adData.reduce((sum, item) => sum + item.conversions, 0);
            const totalClicks = adData.reduce((sum, item) => sum + item.clicks, 0);
            const avgCPA = totalConversions > 0 ? totalSpend / totalConversions : 0;
            const avgCVR = totalClicks > 0 ? (totalConversions / totalClicks * 100) : 0;
            
            // Update metrics
            document.getElementById('total-spend').textContent = 'â‚©' + totalSpend.toLocaleString();
            document.getElementById('total-conversions').textContent = totalConversions.toLocaleString() + 'ëª…';
            document.getElementById('avg-cpa').textContent = 'â‚©' + Math.round(avgCPA).toLocaleString();
            document.getElementById('avg-cvr').textContent = avgCVR.toFixed(1) + '%';
            
            // Update comparisons (ê°€ì •: ì—…ê³„ í‰ê·  CPA 12,000ì›, CVR 10%)
            const industryAvgCPA = 12000;
            const industryAvgCVR = 10;
            const cpaComparison = ((industryAvgCPA - avgCPA) / industryAvgCPA * 100).toFixed(0);
            const cvrComparison = ((avgCVR - industryAvgCVR) / industryAvgCVR * 100).toFixed(0);
            
            document.getElementById('cpa-comparison').textContent = (cpaComparison > 0 ? '-' : '+') + Math.abs(cpaComparison) + '%';
            document.getElementById('cvr-comparison').textContent = (cvrComparison > 0 ? '+' : '') + cvrComparison + '%';
            
            // Update conversion rate vs target
            const targetConversions = 180; // ëª©í‘œ ê°€ì…ììˆ˜
            const conversionRate = (totalConversions / targetConversions * 100 - 100).toFixed(0);
            document.getElementById('conversion-rate').textContent = (conversionRate > 0 ? '+' : '') + conversionRate + '%';
            
            // Update header info
            const dates = adData.map(d => new Date(d.date));
            const minDate = new Date(Math.min(...dates));
            const maxDate = new Date(Math.max(...dates));
            document.getElementById('date-range').textContent = `${minDate.toLocaleDateString('ko-KR')} - ${maxDate.toLocaleDateString('ko-KR')}`;
            document.getElementById('campaign-count').textContent = new Set(adData.map(d => d.campaign)).size + 'ê°œ';
            document.getElementById('platform').textContent = 'Meta Ads';
        }

        function updateCharts() {
            // CPA Chart by Target
            const targetData = {};
            adData.forEach(item => {
                if (!targetData[item.target]) {
                    targetData[item.target] = { spend: 0, conversions: 0, clicks: 0 };
                }
                targetData[item.target].spend += item.spend;
                targetData[item.target].conversions += item.conversions;
                targetData[item.target].clicks += item.clicks;
            });
            
            const targets = Object.keys(targetData).sort((a, b) => {
                const cpaA = targetData[a].conversions > 0 ? targetData[a].spend / targetData[a].conversions : Infinity;
                const cpaB = targetData[b].conversions > 0 ? targetData[b].spend / targetData[b].conversions : Infinity;
                return cpaA - cpaB;
            });
            
            const cpaData = targets.map(target => {
                const data = targetData[target];
                return data.conversions > 0 ? Math.round(data.spend / data.conversions) : 0;
            });
            
            // Color coding for CPA
            const colors = cpaData.map(cpa => {
                if (cpa < 8000) return 'rgba(34, 197, 94, 0.8)'; // Green
                if (cpa < 10000) return 'rgba(251, 191, 36, 0.8)'; // Yellow
                if (cpa < 15000) return 'rgba(251, 146, 60, 0.8)'; // Orange
                return 'rgba(239, 68, 68, 0.8)'; // Red
            });
            
            const ctx1 = document.getElementById('cpa-chart').getContext('2d');
            if (charts.cpa) charts.cpa.destroy();
            charts.cpa = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: targets,
                    datasets: [{
                        label: 'CPA (ì›)',
                        data: cpaData,
                        backgroundColor: colors,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'â‚©' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Pie Chart - Conversion Distribution
            const conversionData = targets.map(target => targetData[target].conversions);
            
            const ctx2 = document.getElementById('pie-chart').getContext('2d');
            if (charts.pie) charts.pie.destroy();
            charts.pie = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: targets,
                    datasets: [{
                        data: conversionData,
                        backgroundColor: [
                            'rgba(99, 102, 241, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(251, 191, 36, 0.8)',
                            'rgba(251, 146, 60, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(168, 85, 247, 0.8)',
                            'rgba(59, 130, 246, 0.8)'
                        ],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
        }

        function updateTable() {
            // Aggregate data by target
            const targetData = {};
            adData.forEach(item => {
                if (!targetData[item.target]) {
                    targetData[item.target] = {
                        target: item.target,
                        spend: 0,
                        conversions: 0,
                        clicks: 0,
                        impressions: 0
                    };
                }
                targetData[item.target].spend += item.spend;
                targetData[item.target].conversions += item.conversions;
                targetData[item.target].clicks += item.clicks;
                targetData[item.target].impressions += item.impressions;
            });
            
            // Convert to array and calculate metrics
            const tableData = Object.values(targetData).map(data => ({
                ...data,
                cpa: data.conversions > 0 ? Math.round(data.spend / data.conversions) : 0,
                cvr: data.clicks > 0 ? (data.conversions / data.clicks * 100).toFixed(1) : 0
            }));
            
            // Sort by CPA
            tableData.sort((a, b) => {
                const cpaA = a.conversions > 0 ? a.cpa : Infinity;
                const cpaB = b.conversions > 0 ? b.cpa : Infinity;
                return cpaA - cpaB;
            });
            
            const tbody = document.getElementById('campaign-table-body');
            tbody.innerHTML = tableData.map((row, index) => {
                const status = row.cpa < 10000 ? 'good' : row.cpa < 15000 ? 'average' : 'poor';
                const statusBadge = status === 'good' ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">ğŸŸ¢ ê³ íš¨ìœ¨</span>' :
                                   status === 'average' ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">ğŸŸ¡ ë³´í†µ</span>' :
                                   '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">ğŸ”´ ê°œì„ í•„ìš”</span>';
                
                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}ìœ„</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${row.target}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">â‚©${row.spend.toLocaleString()}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">${row.conversions}ëª…</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900">â‚©${row.cpa.toLocaleString()}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">${row.cvr}%</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">${statusBadge}</td>
                    </tr>
                `;
            }).join('');
        }

        function generateRecommendations() {
            const recommendations = [
                {
                    icon: 'trending-up',
                    color: 'green',
                    title: 'ì˜ˆì‚° ì¦ì•¡ (30%)',
                    targets: 'ì¹¸ì•„ì¹´ë°ë¯¸, ì¿ ëª¬',
                    impact: 'CPA -59,965ì› â†’ 8,856ì›',
                    description: 'ê³ íš¨ìœ¨ íƒ€ê²Ÿ ì˜ˆì‚° í™•ëŒ€'
                },
                {
                    icon: 'trending-down',
                    color: 'yellow',
                    title: 'ì˜ˆì‚° ê°ì•¡ (20%)',
                    targets: 'IB, GPA',
                    impact: 'ì›” ê°€ì…ì +23ëª… ì¦ê°€',
                    description: 'ì €íš¨ìœ¨ íƒ€ê²Ÿ ì˜ˆì‚° ì¡°ì •'
                },
                {
                    icon: 'zap',
                    color: 'purple',
                    title: 'ì¦‰ê° ì‹¤í–‰',
                    targets: '119,963ì› ì ˆì•½',
                    impact: 'ROI +29% ê°œì„ ',
                    description: 'ì˜ˆìƒ ì„±ê³¼ ê°œì„ '
                }
            ];
            
            const container = document.getElementById('recommendations');
            container.innerHTML = recommendations.map(rec => `
                <div class="bg-white rounded-lg p-4 border border-gray-200">
                    <div class="flex items-start gap-3">
                        <div class="p-2 bg-${rec.color}-100 rounded-lg">
                            <i data-lucide="${rec.icon}" class="w-4 h-4 text-${rec.color}-700"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">${rec.title}</h4>
                            <p class="text-sm text-gray-600 mt-1">${rec.targets}</p>
                            <p class="text-xs text-gray-500 mt-2">${rec.description}</p>
                            <p class="text-sm font-semibold text-${rec.color}-600 mt-2">${rec.impact}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function exportReport() {
            // Simple CSV export
            const headers = ['íƒ€ê²Ÿ', 'ì§€ì¶œ(ì›)', 'ê°€ì…ì', 'CPA(ì›)', 'CVR(%)'];
            const targetData = {};
            
            adData.forEach(item => {
                if (!targetData[item.target]) {
                    targetData[item.target] = {
                        target: item.target,
                        spend: 0,
                        conversions: 0,
                        clicks: 0
                    };
                }
                targetData[item.target].spend += item.spend;
                targetData[item.target].conversions += item.conversions;
                targetData[item.target].clicks += item.clicks;
            });
            
            const rows = Object.values(targetData).map(data => [
                data.target,
                data.spend,
                data.conversions,
                data.conversions > 0 ? Math.round(data.spend / data.conversions) : 0,
                data.clicks > 0 ? (data.conversions / data.clicks * 100).toFixed(1) : 0
            ]);
            
            let csvContent = headers.join(',') + '\n';
            rows.forEach(row => {
                csvContent += row.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `mathkong_report_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
    </script>
</body>
</html>